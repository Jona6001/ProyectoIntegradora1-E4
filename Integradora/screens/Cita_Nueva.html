<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registrar Nueva Cita</title>
    <link rel="stylesheet" href="styles.css"> <!-- Asegúrate de tener una hoja de estilo -->
</head>
<body>
    <header>
        <h1>Registrar Nueva Cita</h1>
        <div id="bienvenido"></div>
        <button onclick="cerrarSesion()">Cerrar Sesión</button>
    </header>
    <main>
        <form id="citaForm">
            <label for="clienteSelect">Seleccionar Cliente:</label>
            <select id="clienteSelect" required></select>

            <label for="empleadoSelect">Seleccionar Empleado:</label>
            <select id="empleadoSelect" required></select>

            <label for="fechaInput">Fecha:</label>
            <input type="date" id="fechaInput" required />

            <label for="horaInput">Hora:</label>
            <input type="time" id="horaInput" required />

            <button type="button" onclick="guardarCita()">Guardar Cita</button>
        </form>
    </main>

    <script>
        async function cargarClientes() {
            const response = await fetch('/clientes');
            const clientes = await response.json();
            const clienteSelect = document.getElementById('clienteSelect');
            clientes.forEach(cliente => {
                const option = document.createElement('option');
                option.value = cliente.Cliente_ID;
                option.textContent = `${cliente.Nombre} ${cliente.Apellido_Paterno}`;
                clienteSelect.appendChild(option);
            });
        }

        async function cargarEmpleados() {
            const response = await fetch('/empleados');
            const empleados = await response.json();
            const empleadoSelect = document.getElementById('empleadoSelect');
            empleados.forEach(empleado => {
                const option = document.createElement('option');
                option.value = empleado.Empleados_ID;
                option.textContent = empleado.Username;
                empleadoSelect.appendChild(option);
            });
        }

        async function guardarCita() {
            const clienteId = document.getElementById('clienteSelect').value;
            const empleadoId = document.getElementById('empleadoSelect').value;
            const fecha = document.getElementById('fechaInput').value;
            const hora = document.getElementById('horaInput').value;

            if (!clienteId || !empleadoId || !fecha || !hora) {
                alert('Por favor, completa todos los campos.');
                return;
            }

            const response = await fetch('/nueva_cita', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ clienteId, empleadoId, fecha, hora })
            });

            if (response.ok) {
                alert('Cita guardada con éxito');
                // Aquí puedes redirigir o limpiar el formulario
                document.getElementById('citaForm').reset();
            } else {
                alert('Error al guardar la cita');
            }
        }

        function mostrarUsuNomb() {
            const usuario = localStorage.getItem('usuario');
            document.getElementById("bienvenido").textContent = usuario ? `Bienvenido ${usuario}` : "Bienvenido, Usuario Desconocido";
        }

        function cerrarSesion() {
            localStorage.removeItem('usuario');
            window.location.href = "../index.html";
        }

        // Cargar clientes y empleados al cargar la página
        window.onload = () => {
            mostrarUsuNomb();
            cargarClientes();
            cargarEmpleados();
        };
    </script>
</body>
</html>
